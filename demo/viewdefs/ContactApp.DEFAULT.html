<template>
  <style>
    /* App Layout */
    .app-header {
      display: flex;
      align-items: center;
      gap: var(--sl-spacing-medium);
      margin-bottom: var(--sl-spacing-large);
    }
    .app-header h1 {
      margin: 0;
      flex: 1;
    }

    /* Toolbar */
    .toolbar {
      display: flex;
      gap: var(--sl-spacing-medium);
      margin-bottom: var(--sl-spacing-large);
    }
    .toolbar sl-input {
      flex: 1;
    }

    /* Contact List */
    .contact-list {
      display: flex;
      flex-direction: column;
      gap: var(--sl-spacing-small);
    }

    /* Contact Card (in ContactPresenter) */
    .contact-card {
      display: flex;
      align-items: center;
      padding: var(--sl-spacing-medium);
      background: var(--sl-color-neutral-0);
      border: 1px solid var(--sl-color-neutral-200);
      border-radius: var(--sl-border-radius-medium);
    }
    .contact-info {
      flex: 1;
    }
    .contact-name {
      font-weight: var(--sl-font-weight-semibold);
      color: var(--sl-color-neutral-900);
    }
    .contact-email {
      color: var(--sl-color-primary-600);
      font-size: var(--sl-font-size-small);
    }
    .contact-phone {
      color: var(--sl-color-neutral-500);
      font-size: var(--sl-font-size-small);
    }
    .contact-actions {
      display: flex;
      gap: var(--sl-spacing-x-small);
    }

    /* Edit Form */
    .edit-form {
      background: var(--sl-color-neutral-0);
      padding: var(--sl-spacing-large);
      border-radius: var(--sl-border-radius-medium);
      border: 1px solid var(--sl-color-neutral-200);
    }
    .edit-form h2 {
      margin: 0 0 var(--sl-spacing-large) 0;
    }
    .form-row {
      display: flex;
      gap: var(--sl-spacing-medium);
      margin-bottom: var(--sl-spacing-medium);
    }
    .form-row > * {
      flex: 1;
      min-width: 0;
    }
    .form-row.full-width {
      display: block;
    }
    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: var(--sl-spacing-medium);
      margin-top: var(--sl-spacing-large);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: var(--sl-spacing-2x-large);
      color: var(--sl-color-neutral-500);
    }

    /* Utilities */
    .hidden, [hidden] {
      display: none !important;
    }
  </style>

  <div>
    <!-- Header -->
    <header class="app-header">
      <h1 ui-value="title"></h1>
      <sl-badge variant="neutral" ui-value="contactCount()"></sl-badge>
    </header>

    <!-- Error alert -->
    <sl-alert variant="danger" class="error-alert" ui-attr-open="error" closable>
      <sl-icon slot="icon" name="exclamation-octagon"></sl-icon>
      <span ui-value="error"></span>
    </sl-alert>

    <!-- List View (shown when currentView == "list") -->
    <div ui-attr-hidden="isEditView">
      <!-- Toolbar -->
      <div class="toolbar">
        <sl-input
          placeholder="Search contacts..."
          ui-value="searchQuery?keypress"
          ui-event-keypress-enter="selectFirstContact()"
          clearable>
          <sl-icon name="search" slot="prefix"></sl-icon>
        </sl-input>
        <sl-button variant="primary" ui-action="addContact()">
          <sl-icon slot="prefix" name="plus-lg"></sl-icon>
          Add Contact
        </sl-button>
      </div>

      <!-- Contact List (each contact wrapped with ContactPresenter) -->
      <div class="contact-list" ui-view="contacts()?wrapper=lua.ViewList&itemWrapper=ContactPresenter"></div>

      <!-- Empty state -->
      <div class="empty-state" ui-attr-hidden="hasContacts()">
        <sl-icon name="person-rolodex" style="font-size: 3rem; margin-bottom: 1rem;"></sl-icon>
        <p>No contacts yet. Click "Add Contact" to get started.</p>
      </div>
    </div>

    <!-- Edit View (shown when currentView == "edit") -->
    <div class="edit-form" ui-attr-hidden="isListView">
      <h2 ui-value="formTitle"></h2>

      <div class="form-row">
        <sl-input
          label="First Name"
          ui-value="editFirstName"
          required>
        </sl-input>
        <sl-input
          label="Last Name"
          ui-value="editLastName">
        </sl-input>
      </div>

      <div class="form-row">
        <sl-input
          label="Email"
          type="email"
          ui-value="editEmail"
          required>
          <sl-icon name="envelope" slot="prefix"></sl-icon>
        </sl-input>
        <sl-input
          label="Phone"
          type="tel"
          ui-value="editPhone">
          <sl-icon name="telephone" slot="prefix"></sl-icon>
        </sl-input>
      </div>

      <div class="form-row full-width">
        <sl-textarea
          label="Notes"
          ui-value="editNotes"
          rows="3">
        </sl-textarea>
      </div>

      <div class="form-actions">
        <sl-button variant="default" ui-action="cancelEdit()">Cancel</sl-button>
        <sl-button variant="primary" ui-action="saveContact()">
          <sl-icon slot="prefix" name="check-lg"></sl-icon>
          Save Contact
        </sl-button>
      </div>
    </div>
  </div>
</template>
