var z=Object.defineProperty;var G=(a,e,t)=>e in a?z(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var c=(a,e,t)=>G(a,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();function U(a){return JSON.stringify(a)}const $={high:0,medium:1,low:2};class J{constructor(e){c(this,"pendingMessages",[]);c(this,"throttleTimer",null);c(this,"insertionOrder",0);c(this,"sendFn");c(this,"throttleInterval",200);this.sendFn=e}shouldBypassBatch(e){return e.type==="create"}enqueue(e,t="medium"){this.pendingMessages.push({message:e,priority:t,order:this.insertionOrder++}),this.startThrottle()}sendImmediate(e){this.sendFn(U(e))}flush(){if(this.pendingMessages.length===0)return;this.pendingMessages.sort((t,s)=>{const i=$[t.priority]-$[s.priority];return i!==0?i:t.order-s.order});const e=this.pendingMessages.map(t=>t.message);this.pendingMessages=[],this.insertionOrder=0,this.sendFn(JSON.stringify(e))}startThrottle(){this.throttleTimer===null&&(this.throttleTimer=setTimeout(()=>{this.throttleTimer=null,this.flush()},this.throttleInterval))}cancelThrottle(){this.throttleTimer!==null&&(clearTimeout(this.throttleTimer),this.throttleTimer=null)}flushNow(){this.cancelThrottle(),this.flush()}get pendingCount(){return this.pendingMessages.length}}class Y{constructor(e){c(this,"ws",null);c(this,"sessionId");c(this,"reconnectAttempts",0);c(this,"maxReconnectAttempts",5);c(this,"reconnectDelay",1e3);c(this,"messageHandlers",[]);c(this,"errorHandlers",[]);c(this,"connectHandlers",[]);c(this,"disconnectHandlers",[]);c(this,"requestId",1);c(this,"createCallbacks",new Map);c(this,"batcher");this.sessionId=e,this.batcher=new J(t=>this.sendRaw(t))}connect(){return new Promise((e,t)=>{const i=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/${this.sessionId}`;this.ws=new WebSocket(i),this.ws.onopen=()=>{this.reconnectAttempts=0,this.connectHandlers.forEach(r=>r()),e()},this.ws.onmessage=r=>{try{const n=JSON.parse(r.data);"result"in n||"error"in n&&!("type"in n)||"pending"in n||"id"in n?(console.log("RECEIVED RESPONSE",JSON.stringify(n)),this.handleResponse(n)):(console.log("RECEIVED MESSAGE",JSON.stringify(n)),this.handleMessage(n))}catch(n){console.error("Failed to parse message:",n)}},this.ws.onerror=r=>{console.error("WebSocket error:",r),t(new Error("WebSocket connection failed"))},this.ws.onclose=()=>{this.disconnectHandlers.forEach(r=>r()),this.attemptReconnect()}})}attemptReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){this.errorHandlers.forEach(t=>t("Max reconnection attempts reached"));return}this.reconnectAttempts++;const e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);setTimeout(()=>{this.connect().catch(()=>{})},e)}handleMessage(e){this.messageHandlers.forEach(t=>t(e))}handleResponse(e){const t=e.result;if(t&&typeof t=="object"&&"id"in t&&t.requestId){const s=this.createCallbacks.get(t.requestId);s&&(this.createCallbacks.delete(t.requestId),s(e))}}sendRaw(e){this.ws&&this.ws.readyState===WebSocket.OPEN?this.ws.send(e):console.error("WebSocket not connected")}send(e,t="medium"){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){console.error("WebSocket not connected");return}this.batcher.enqueue(e,t)}sendAndAwaitResponse(e){return new Promise((t,s)=>{if(!this.ws||this.ws.readyState!==WebSocket.OPEN){s(new Error("WebSocket not connected"));return}const i=this.requestId++,r=e.data||{};r.requestId=i,e.data=r,this.createCallbacks.set(i,t),this.ws.send(U(e))})}onMessage(e){return this.messageHandlers.push(e),()=>{const t=this.messageHandlers.indexOf(e);t>=0&&this.messageHandlers.splice(t,1)}}onError(e){return this.errorHandlers.push(e),()=>{const t=this.errorHandlers.indexOf(e);t>=0&&this.errorHandlers.splice(t,1)}}onConnect(e){return this.connectHandlers.push(e),()=>{const t=this.connectHandlers.indexOf(e);t>=0&&this.connectHandlers.splice(t,1)}}onDisconnect(e){return this.disconnectHandlers.push(e),()=>{const t=this.disconnectHandlers.indexOf(e);t>=0&&this.disconnectHandlers.splice(t,1)}}disconnect(){this.batcher.flushNow(),this.ws&&(this.ws.close(),this.ws=null)}isConnected(){return this.ws!==null&&this.ws.readyState===WebSocket.OPEN}}class X{constructor(e){c(this,"variables",new Map);c(this,"errors",new Map);c(this,"watchers",new Map);c(this,"errorWatchers",new Map);c(this,"connection");this.connection=e,e.onMessage(t=>{if(t.type==="update"){const s=t.data;this.handleUpdate(s.varId,s.value,s.properties)}else if(t.type==="destroy"){const s=t.data;this.handleDestroy(s.varId)}else if(t.type==="error"){const s=t.data;s.varId!==void 0&&this.handleError(s.varId,s.code,s.description)}})}handleUpdate(e,t,s,i){let r=this.variables.get(e);r||(r={varId:e,value:void 0,properties:{}},i!==void 0&&(r.parentId=i),this.variables.set(e,r)),console.log("handleUpdate varId",e,"parentId",r.parentId),t!==void 0&&(r.value=t),s&&(r.properties={...r.properties,...s}),this.errors.has(e)&&(this.errors.delete(e),this.notifyErrorWatchers(e,null));const n=this.watchers.get(e);n&&n.forEach(u=>u(r,t,s))}handleError(e,t,s){const i={code:t,description:s};this.errors.set(e,i),this.notifyErrorWatchers(e,i)}notifyErrorWatchers(e,t){const s=this.errorWatchers.get(e);s&&s.forEach(i=>i(t))}handleDestroy(e){this.variables.delete(e),this.watchers.delete(e)}watch(e,t,s){let i=this.watchers.get(e);return i||(i=new Set,this.watchers.set(e,i),s&&this.connection.send({type:"watch",data:{varId:e}})),i.add(t),()=>{i.delete(t),i.size===0&&(this.watchers.delete(e),this.connection.send({type:"unwatch",data:{varId:e}}))}}watchErrors(e,t){let s=this.errorWatchers.get(e);s||(s=new Set,this.errorWatchers.set(e,s)),s.add(t);const i=this.errors.get(e)??null;return t(i),()=>{s.delete(t),s.size===0&&this.errorWatchers.delete(e)}}getError(e){return this.errors.get(e)??null}get(e){return this.variables.get(e)}async create(e){var s;console.log("SENDING CREATE");const t=await this.connection.sendAndAwaitResponse({type:"create",data:e});if(t.error)throw new Error(t.error);if(!t.result)throw new Error("No result from create");if((s=t.pending)!=null&&s.length){const i=t.pending[0].data;console.log("CREATE RESPONSE",t.result.id,t);const r={varId:i.varId,value:void 0,properties:e.properties||{}};e.parentId!==void 0&&(r.parentId=e.parentId),e.widget&&(r.widget=e.widget),this.variables.set(i.varId,r),setTimeout(()=>{console.log("UPDATE FROM CREATE RESPONSE",i.varId,t),this.handleUpdate(i.varId,i.value,i.properties,e.parentId)})}return t.result.id}update(e,t,s){var r;const i=this.variables.get(e);if(i&&t!==void 0){const n=(r=i.properties)==null?void 0:r.access;if(!(n==="action"||n==="w")&&i.value===t)return}i&&(t!==void 0&&(i.value=t),s&&(i.properties={...i.properties,...s})),this.connection.send({type:"update",data:{varId:e,value:t,properties:s}})}destroy(e){this.connection.send({type:"destroy",data:{varId:e}})}sendError(e,t,s){this.connection.send({type:"error",data:{varId:e,code:t,description:s}}),this.handleError(e,t,s)}}let Q=1;function j(){return`ui-${Q++}`}function B(a){return a.id||(a.id=j()),a.id}const Z={"SL-BADGE":!0},ee=new Set(["SL-COPY-BUTTON","SL-OPTION","SL-PROGRESS-BAR","SL-PROGRESS-RING","SL-QR-CODE"]),te=new Set(["INPUT","TEXTAREA","SL-INPUT","SL-TEXTAREA"]);function se(a){return!te.has(a.tagName)}function ie(a){return a instanceof HTMLElement&&a.nodeName.startsWith("SL-")}function N(a){const[e,t]=a.split("?"),s=e.split("."),i={};if(t){const r=new URLSearchParams(t),n=d=>{const l=r.get(d);return l===""?"true":l};r.has("create")&&(i.create=n("create")),r.has("wrapper")&&(i.wrapper=n("wrapper")),r.has("item")&&(i.item=n("item"));const u={};r.forEach((d,l)=>{l!=="create"&&l!=="wrapper"&&l!=="item"&&(u[l]=d===""?"true":d)}),Object.keys(u).length>0&&(i.props=u)}return{segments:s,options:i}}function C(a){const e={};return a.create&&(e.create=a.create),a.wrapper&&(e.wrapper=a.wrapper),a.item&&(e.item=a.item),a.props&&Object.assign(e,a.props),e}class D{constructor(e){c(this,"elementId");c(this,"variables",new Map);c(this,"unbindHandlers",new Map);c(this,"view");c(this,"scrollOnOutput",!1);e.id||(e.id=B(e)),this.elementId=e.id}scrollToBottom(){const e=this.getElement();e&&e.scrollHeight>e.clientHeight&&(e.scrollTop=e.scrollHeight)}registerBinding(e,t,s){this.variables.set(e,t),this.unbindHandlers.set(e,s)}getVariableId(e){return this.variables.get(e)}hasBinding(e){return this.variables.has(e)}getElement(){return document.getElementById(this.elementId)}unbindAll(){for(const e of this.unbindHandlers.values())e();this.unbindHandlers.clear(),this.variables.clear()}}const P=class P{constructor(e){c(this,"store");c(this,"widgets",new Map);c(this,"pendingScrollNotifications",new Set);c(this,"scrollProcessingScheduled",!1);this.store=e}addScrollNotification(e){this.pendingScrollNotifications.add(e),this.scrollProcessingScheduled||(this.scrollProcessingScheduled=!0,queueMicrotask(()=>{this.scrollProcessingScheduled=!1,this.processScrollNotifications()}))}processScrollNotifications(){let e=new Set(this.pendingScrollNotifications);for(this.pendingScrollNotifications.clear();e.size>0;){const t=new Set;for(const s of e){const i=this.store.get(s);if(!i)continue;const r=i.properties.elementId;if(r){const n=this.widgets.get(r);if(n!=null&&n.scrollOnOutput){n.scrollToBottom();continue}}i.parentId&&t.add(i.parentId)}e=t}}getWidget(e){return this.widgets.get(e)}getView(e){const t=this.widgets.get(e);return t==null?void 0:t.view}setViewForElement(e,t){let s=this.widgets.get(e);if(!s){const i=document.getElementById(e);if(!i)return;s=new D(i),this.widgets.set(e,s)}s.view=t}bindElement(e,t){let s=!1;const i=new D(e),r=e.getAttribute("ui-value");r&&(this.createValueBinding(e,t,r,i),s=!0);for(const l of Array.from(e.attributes))if(l.name.startsWith("ui-attr-")){const o=l.name.substring(8);this.createAttrBinding(t,l.value,o,i),s=!0}for(const l of Array.from(e.attributes))if(l.name.startsWith("ui-class-")){const o=l.name.substring(9);this.createClassBinding(t,l.value,o,i),s=!0}for(const l of Array.from(e.attributes))if(l.name.startsWith("ui-style-")){const o=l.name.substring(9);this.createStyleBinding(t,l.value,o,i),s=!0}for(const l of Array.from(e.attributes))if(l.name.startsWith("ui-event-")){const o=l.name.substring(9);this.createEventBinding(e,t,l.value,o,i),s=!0}const n=e.getAttribute("ui-action");n&&(this.createActionBinding(e,t,n,i),s=!0);const u=e.getAttribute("ui-code");u&&(this.createCodeBinding(t,u,i),s=!0);const d=e.getAttribute("ui-html");d&&(this.createHtmlBinding(t,d,i),s=!0),s&&this.widgets.set(i.elementId,i);for(const l of Array.from(e.children))this.bindElement(l,t)}unbindElement(e){const t=e.id;if(t){const s=this.widgets.get(t);s&&(s.unbindAll(),this.widgets.delete(t))}for(const s of Array.from(e.children))this.unbindElement(s)}createValueBinding(e,t,s,i){var _,x,K;const r=N(s),n=C(r.options);n.path=r.segments.join(".");const u=((_=r.options.props)==null?void 0:_.keypress)==="true",d=((x=r.options.props)==null?void 0:x.scrollOnOutput)==="true";d&&(i.scrollOnOutput=!0);let l=null,o=null,h=null;const f=!(e instanceof HTMLButtonElement)&&(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement||ie(e)||"value"in e&&!(e.nodeName in Z)),w=i.elementId,T=()=>{if(d){const g=document.getElementById(w);g&&g.scrollHeight>g.clientHeight&&(g.scrollTop=g.scrollHeight)}},I=se(e),A=f?g=>{const v=document.getElementById(w);v&&(typeof g=="number"?v.value=g:v.value=(g==null?void 0:g.toString())??"",T(),I&&this.addScrollNotification(t))}:g=>{const v=document.getElementById(w);v&&(v.textContent=(g==null?void 0:g.toString())??"",T(),I&&this.addScrollNotification(t))},R=g=>{const v=document.getElementById(w);v&&(g?(v.classList.add("ui-error"),v.setAttribute("ui-error-code",g.code),v.setAttribute("ui-error-description",g.description)):(v.classList.remove("ui-error"),v.removeAttribute("ui-error-code"),v.removeAttribute("ui-error-description")))},m=g=>{if(l!==null){const v=g.target;this.store.update(l,v.value)}};if((K=r.segments[r.segments.length-1])==null?void 0:K.endsWith("()")){if(n.access===void 0)n.access="r";else if(n.access!=="r"&&n.access!=="action"){console.error(`Invalid access '${n.access}' for method call path '${s}' - must be 'r' or 'action'`);return}}else(!f&&n.access===void 0||ee.has(e.nodeName)&&n.access===void 0)&&(n.access="r");this.store.create({parentId:t,properties:n,widget:i}).then(g=>{l=g,o=this.store.watch(g,(Se,q)=>A(q)),h=this.store.watchErrors(g,R);const v=this.store.get(g);v&&A(v.value),i.registerBinding("ui-value",g,()=>{o&&o(),h&&h(),O&&e.removeEventListener(O,m),L&&e.removeEventListener(L,H),e.removeEventListener("ui-value-change",V),this.store.destroy(g),e.classList.remove("ui-error"),e.removeAttribute("ui-error-code"),e.removeAttribute("ui-error-description")})}).catch(g=>{console.error("Failed to create binding variable:",g)});const E=e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement,y=e.tagName.toLowerCase(),S=y==="sl-input"||y==="sl-textarea";let O=null,L=null;E&&(O=u?"input":"blur"),S&&(L=u?"sl-input":"sl-change"),O&&e.addEventListener(O,m);const H=g=>{if(l!==null){const v=g.target;this.store.update(l,v.value)}};L&&e.addEventListener(L,H);const V=g=>{const v=g;l!==null&&this.store.update(l,v.detail.value)};e.addEventListener("ui-value-change",V)}createAttrBinding(e,t,s,i){var l;const r=N(t),n=C(r.options);n.path=r.segments.join("."),((l=r.options.props)==null?void 0:l.scrollOnOutput)==="true"&&(i.scrollOnOutput=!0),n.access||(n.access="r");const u=i.elementId,d=o=>{const h=document.getElementById(u);h&&(o!=null&&o!==!1?h.setAttribute(s,o.toString()):h.removeAttribute(s))};this.store.create({parentId:e,properties:n,widget:i}).then(o=>{const h=this.store.watch(o,(f,w)=>d(w)),p=this.store.get(o);p&&d(p.value),i.registerBinding(`ui-attr-${s}`,o,()=>{h(),this.store.destroy(o)})}).catch(o=>{console.error("Failed to create attr binding variable:",o)})}createClassBinding(e,t,s,i){var l;const r=N(t),n=C(r.options);n.path=r.segments.join("."),((l=r.options.props)==null?void 0:l.scrollOnOutput)==="true"&&(i.scrollOnOutput=!0),n.access||(n.access="r");const u=i.elementId,d=o=>{const h=document.getElementById(u);h&&(o?h.classList.add(s):h.classList.remove(s))};this.store.create({parentId:e,properties:n,widget:i}).then(o=>{const h=this.store.watch(o,(f,w)=>d(w)),p=this.store.get(o);p&&d(p.value),i.registerBinding(`ui-class-${s}`,o,()=>{h(),this.store.destroy(o)})}).catch(o=>{console.error("Failed to create class binding variable:",o)})}createStyleBinding(e,t,s,i){var l;const r=N(t),n=C(r.options);n.path=r.segments.join("."),((l=r.options.props)==null?void 0:l.scrollOnOutput)==="true"&&(i.scrollOnOutput=!0),n.access||(n.access="r");const u=i.elementId,d=o=>{const h=document.getElementById(u);h&&(o!=null?h.style.setProperty(s,o.toString()):h.style.removeProperty(s))};this.store.create({parentId:e,properties:n,widget:i}).then(o=>{const h=this.store.watch(o,(f,w)=>d(w)),p=this.store.get(o);p&&d(p.value),i.registerBinding(`ui-style-${s}`,o,()=>{h(),this.store.destroy(o)})}).catch(o=>{console.error("Failed to create style binding variable:",o)})}createCodeBinding(e,t,s){var l;const i=N(t),r=C(i.options);r.path=i.segments.join("."),((l=i.options.props)==null?void 0:l.scrollOnOutput)==="true"&&(s.scrollOnOutput=!0),r.access||(r.access="r");const n=s.elementId;let u=null;const d=o=>{if(typeof o!="string"||!o)return;const h=document.getElementById(n);if(h)try{const p=new Function("element","value","variable","store",o),f=u!==null?this.store.get(u):null;p(h,f==null?void 0:f.value,f,this.store)}catch(p){console.error("Error executing ui-code:",p)}};this.store.create({parentId:e,properties:r,widget:s}).then(o=>{u=o;const h=this.store.watch(o,(f,w)=>d(w)),p=this.store.get(o);p!=null&&p.value&&d(p.value),s.registerBinding("ui-code",o,()=>{h(),this.store.destroy(o)})}).catch(o=>{console.error("Failed to create code binding variable:",o)})}createHtmlBinding(e,t,s){var A,R;const i=N(t),r=C(i.options);r.path=i.segments.join("."),((A=i.options.props)==null?void 0:A.scrollOnOutput)==="true"&&(s.scrollOnOutput=!0),r.access||(r.access="r");const n=((R=i.options.props)==null?void 0:R.replace)==="true",u=s.elementId;let d=[u];function l(m){const b=document.createElement("div");return b.innerHTML=m,Array.from(b.childNodes)}function o(m){return m.map((b,E)=>(b.id=E===0?u:j(),b.id))}function h(){const m=document.createElement("span");return m.id=u,m.style.display="none",m}function p(m){const b=document.createElement("span");b.id=u;for(const E of m)b.appendChild(E);return b}function f(m,b,E){for(const y of b)m.insertBefore(y,E)}const I=n?m=>{var H;const b=(m??"").toString(),E=document.getElementById(d[0]);if(!(E!=null&&E.parentNode))return;const y=E.parentNode,S=E.nextSibling;for(const V of d)(H=document.getElementById(V))==null||H.remove();const O=l(b),L=O.filter(V=>V instanceof Element);O.length===0?(y.insertBefore(h(),S),d=[u]):L.length===0?(y.insertBefore(p(O),S),d=[u]):(d=o(L),f(y,O,S)),this.addScrollNotification(e)}:m=>{const b=document.getElementById(u);b&&(b.innerHTML=(m??"").toString(),this.addScrollNotification(e))};this.store.create({parentId:e,properties:r,widget:s}).then(m=>{const b=this.store.watch(m,(y,S)=>I(S)),E=this.store.get(m);E&&I(E.value),s.registerBinding("ui-html",m,()=>{if(b(),this.store.destroy(m),n)for(const y of d){const S=document.getElementById(y);S&&S.remove()}})}).catch(m=>{console.error("Failed to create HTML binding variable:",m)})}normalizeKeyName(e){const t={enter:"Enter",escape:"Escape",left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown",tab:"Tab",space:" "},s=e.toLowerCase();return t[s]??s}matchesTargetKey(e,t){const s=this.normalizeKeyName(t);return s.length===1?e.key.toLowerCase()===s.toLowerCase():e.key===s}parseKeypressAttribute(e){const t=e.toLowerCase().split("-"),s=new Set;let i="";for(const r of t)P.MODIFIER_KEYS.has(r)?s.add(r):i=r;return{modifiers:s,key:i}}matchesModifiers(e,t){const s=new Set;if(e.ctrlKey&&s.add("ctrl"),e.shiftKey&&s.add("shift"),e.altKey&&s.add("alt"),e.metaKey&&s.add("meta"),s.size!==t.size)return!1;for(const i of t)if(!s.has(i))return!1;return!0}syncValueBeforeEvent(e,t){const s=t.getVariableId("ui-value");if(s===void 0)return;const i=e.value;if(i===void 0)return;const r=this.store.get(s);r&&r.value!==i&&this.store.update(s,i)}createEventBinding(e,t,s,i,r){if(i.startsWith("keypress-")){this.createKeypressBinding(e,t,s,i,r);return}const n=s.match(/^([\w.]+)\((.*)\)$/);if(!n){console.error("Invalid action expression:",s);return}const[,u,d]=n,h={path:d==="_"?`${u}(_)`:`${u}()`,access:"action"},p=w=>{f!==null&&(this.syncValueBeforeEvent(e,r),this.store.update(f,null))};e.addEventListener(i,p);let f=null;this.store.create({parentId:t,properties:h,widget:r}).then(w=>{f=w,r.registerBinding(`ui-event-${i}`,w,()=>{e.removeEventListener(i,p),this.store.destroy(w)})}).catch(w=>{console.error("Failed to create action variable:",w)})}createKeypressBinding(e,t,s,i,r){const n=i.substring(9);if(!n){console.error("Invalid keypress binding - missing key name:",i);return}const{modifiers:u,key:d}=this.parseKeypressAttribute(n);if(!d){console.error("Invalid keypress binding - no key found:",i);return}const l=N(s),o=C(l.options),h=l.segments.join(".");o.path=h;const p=h.match(/\(\)$/),f=h.match(/\(_\)$/);(p||f)&&(o.access="action");let w=null;const T=I=>{const A=I;this.matchesTargetKey(A,d)&&this.matchesModifiers(A,u)&&w!==null&&(this.syncValueBeforeEvent(e,r),this.store.update(w,p?null:d.toLowerCase()))};e.addEventListener("keydown",T),this.store.create({parentId:t,properties:o,widget:r}).then(I=>{w=I,r.registerBinding(`ui-event-${i}`,I,()=>{e.removeEventListener("keydown",T),this.store.destroy(I)})}).catch(I=>{console.error("Failed to create keypress binding variable:",I)})}createActionBinding(e,t,s,i){const r=s.match(/^([\w.]+)\((.*)\)$/);if(!r){console.error("Invalid action expression:",s);return}const[,n,u]=r,o={path:u==="_"?`${n}(_)`:`${n}()`,access:"action"};let h=null;const p=f=>{f.preventDefault(),h!==null&&this.store.update(h,null)};e.addEventListener("click",p),this.store.create({parentId:t,properties:o,widget:i}).then(f=>{h=f,i.registerBinding("ui-action",f,()=>{e.removeEventListener("click",p),this.store.destroy(f)})}).catch(f=>{console.error("Failed to create action variable:",f)})}};c(P,"MODIFIER_KEYS",new Set(["ctrl","shift","alt","meta"]));let W=P;function re(a){const e=a.indexOf(".");return e===-1?null:{type:a.substring(0,e),namespace:a.substring(e+1)}}function k(a,e){return`${a}.${e}`}function ne(a){const e=document.createElement("div");if(e.innerHTML=a.trim(),e.children.length!==1)return null;const t=e.children[0];return t instanceof HTMLTemplateElement?t:null}function oe(a,e){const t=re(a);if(!t)return null;const s=ne(e);return s?{key:a,type:t.type,namespace:t.namespace,template:s}:null}function ae(a){return a.template.content.cloneNode(!0)}function ce(a){return Array.from(a.querySelectorAll("script"))}function le(a){for(const e of a){const t=document.createElement("script");t.type="text/javascript",t.textContent=e.textContent,e.replaceWith(t)}}class de{constructor(){c(this,"viewdefs",new Map);c(this,"pendingViews",new Map);c(this,"errorHandler");c(this,"viewLookup")}setErrorHandler(e){this.errorHandler=e}setViewLookup(e){this.viewLookup=e}store(e,t){const s=oe(e,t);return s?(this.viewdefs.set(e,s),!0):(this.errorHandler&&this.errorHandler(e,"Invalid viewdef: must be a single <template> element"),!1)}processViewdefs(e){const t=[];for(const[s,i]of Object.entries(e)){const r=this.viewdefs.has(s);this.store(s,i)&&r&&t.push(s)}this.processPendingViews();for(const s of t)this.rerenderViewsForKey(s)}rerenderViewsForKey(e){if(!this.viewLookup){console.warn("[ViewdefStore] Hot-reload: viewLookup not set, cannot re-render");return}const t=`[data-ui-viewdef="${e}"]`,s=document.querySelectorAll(t);console.log(`[ViewdefStore] Hot-reload: re-rendering ${s.length} views for ${e}`);for(const i of s)if(i instanceof HTMLElement&&i.id){const r=this.viewLookup(i.id);if(r)try{r.forceRender()}catch(n){console.error(`[ViewdefStore] Hot-reload: error re-rendering view ${i.id}:`,n)}else console.warn(`[ViewdefStore] Hot-reload: no view found for element ${i.id}`)}}get(e,t,s){if(t){const r=k(e,t),n=this.viewdefs.get(r);if(n)return n}if(s){const r=k(e,s),n=this.viewdefs.get(r);if(n)return n}const i=k(e,"DEFAULT");return this.viewdefs.get(i)}getByKey(e){return this.viewdefs.get(e)}has(e,t){return this.get(e,t)!==void 0}addPendingView(e){this.pendingViews.set(e.id,e)}removePendingView(e){this.pendingViews.delete(e)}processPendingViews(){const e=[];for(const[t,s]of this.pendingViews)s.render()&&e.push(t);for(const t of e)this.pendingViews.delete(t)}getPendingViewCount(){return this.pendingViews.size}getViewdefCount(){return this.viewdefs.size}getKeys(){return Array.from(this.viewdefs.keys())}clear(){this.viewdefs.clear()}}function he(a){const[e,t]=a.split("?"),s={path:e,props:{}};return t&&new URLSearchParams(t).forEach((r,n)=>{n==="item"?s.item=r:s.props[n]=r}),s}class ue{constructor(e,t,s,i){c(this,"elementId");c(this,"itemWrapper");c(this,"variableId",null);c(this,"viewIds",[]);c(this,"exemplarHtml");c(this,"viewdefStore");c(this,"variableStore");c(this,"unwatch",null);c(this,"binding");c(this,"_scrollOnOutput",!1);c(this,"pathConfig",null);this.elementId=B(e),this.itemWrapper=e.getAttribute("ui-item-wrapper")||void 0,this.viewdefStore=t,this.variableStore=s,this.binding=i;const r=e.firstElementChild;r instanceof HTMLElement?(this.exemplarHtml=r.outerHTML,e.removeChild(r)):this.exemplarHtml="<div></div>"}getElement(){return document.getElementById(this.elementId)}setScrollOnOutput(e){this._scrollOnOutput=e}registerWidget(){if(!this.binding)return;this.binding.setViewForElement(this.elementId,{forceRender:()=>this.update()});const e=this.binding.getWidget(this.elementId);e&&this._scrollOnOutput&&(e.scrollOnOutput=!0)}notifyParentRendered(){if(!this.binding||this.variableId===null)return;const e=this.variableStore.get(this.variableId);e!=null&&e.parentId&&this.binding.addScrollNotification(e.parentId)}scrollToBottom(){if(!this.binding)return;const e=this.binding.getWidget(this.elementId);e!=null&&e.scrollOnOutput&&e.scrollToBottom()}getItemWrapper(){}setExemplar(e){this.exemplarHtml=e.outerHTML}setPathConfig(e){this.pathConfig=he(e),(this.pathConfig.props.scrollOnOutput==="true"||this.pathConfig.props.scrollOnOutput==="")&&(this._scrollOnOutput=!0,delete this.pathConfig.props.scrollOnOutput)}getVariableProperties(){const e={};return this.pathConfig&&(this.pathConfig.item&&(e.item=this.pathConfig.item),Object.assign(e,this.pathConfig.props)),e}getBasePath(){var e;return((e=this.pathConfig)==null?void 0:e.path)||""}resolveNamespace(e,t){const s=e.closest("[ui-namespace]");if(!s)return t==null?void 0:t.properties.namespace;const i=this.getElement();return i&&i.contains(s)?s.getAttribute("ui-namespace")||void 0:t==null?void 0:t.properties.namespace}setVariable(e){this.unwatch&&(this.unwatch(),this.unwatch=null),this.variableId=e,this.registerWidget(),this.unwatch=this.variableStore.watch(e,()=>{this.update()}),this.update()}update(){if(this.variableId===null)return;const e=this.variableStore.get(this.variableId);if(!e)return;const t=e.value;if(!Array.isArray(t)){this.clear();return}const s=t.length,i=this.viewIds.slice();for(;i.length<s;){const r=this.createItemView(),n=i.length;i.push(r.elementId);const u=this.itemWrapper?`${n}?wrapper=${this.itemWrapper}`:String(n),d=this.variableStore.get(this.variableId),l=d!=null&&d.parentId?this.variableStore.get(d.parentId):void 0;console.log("CREATE LIST ITEM VIEW WITH PARENT",JSON.stringify(l));const o={path:u,elementId:r.elementId},h=l==null?void 0:l.properties.itemWrapper;h&&(o.wrapper=h);const p=r.getElement();if(p){const f=this.resolveNamespace(p,d);f&&(o.namespace=f)}d!=null&&d.properties.fallbackNamespace&&(o.fallbackNamespace=d.properties.fallbackNamespace),this.variableStore.create({parentId:this.variableId,properties:o}).then(f=>{console.log("setting view ",n," variable ",f),r.setVariable(f)}).catch(f=>{console.error("Failed to create viewlist item variable:",f)})}for(;i.length>s;){const r=i.pop(),n=document.getElementById(r);n&&n.parentNode&&n.parentNode.removeChild(n)}this.viewIds=i,this.scrollToBottom(),this.notifyParentRendered()}createItemView(){const e=document.createElement("template");e.innerHTML=this.exemplarHtml;const t=e.content.firstElementChild,s=this.getElement();return s&&s.appendChild(t),new M(t,this.viewdefStore,this.variableStore,this.binding)}clear(){for(const t of this.viewIds){const s=document.getElementById(t);s&&s.parentNode&&s.parentNode.removeChild(s)}this.viewIds=[];const e=this.getElement();if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}getCount(){return this.viewIds.length}getViewElement(e){const t=this.viewIds[e];return t?document.getElementById(t):null}getViewIds(){return[...this.viewIds]}destroy(){this.unwatch&&(this.unwatch(),this.unwatch=null),this.clear(),this.variableId!==null&&(this.variableStore.destroy(this.variableId),this.variableId=null)}}function pe(a,e,t,s){const i=new ue(a,e,t,s),r=a.getAttribute("ui-viewlist");return r&&i.setPathConfig(r),i}const fe=`
.ui-render-marker,
.ui-render-marker ~ * {
  display: none !important;
}
`;(function(){if(document.getElementById("ui-render-marker-style"))return;const e=document.createElement("style");e.id="ui-render-marker-style",e.textContent=fe,document.head.appendChild(e)})();class M{constructor(e,t,s,i){c(this,"elementId");c(this,"valueType","");c(this,"variableId",null);c(this,"rendered",!1);c(this,"viewdefStore");c(this,"variableStore");c(this,"unwatch",null);c(this,"binding");c(this,"viewLists",[]);c(this,"childViews",[]);c(this,"_scrollOnOutput",!1);this.elementId=B(e),this.viewdefStore=t,this.variableStore=s,this.binding=i}getElement(){return document.getElementById(this.elementId)}setScrollOnOutput(e){this._scrollOnOutput=e}notifyParentRendered(){if(!this.binding||this.variableId===null)return;const e=this.variableStore.get(this.variableId);e!=null&&e.parentId&&this.binding.addScrollNotification(e.parentId)}getNamespace(){if(this.variableId===null)return;const e=this.variableStore.get(this.variableId);return e==null?void 0:e.properties.namespace}getFallbackNamespace(){if(this.variableId===null)return;const e=this.variableStore.get(this.variableId);return e==null?void 0:e.properties.fallbackNamespace}resolveNamespace(e,t){const s=e.closest("[ui-namespace]");if(!s){const u=this.variableStore.get(t);return u==null?void 0:u.properties.namespace}const i=this.variableStore.get(t),r=i==null?void 0:i.properties.elementId,n=r?document.getElementById(r):null;return!n||n.contains(s)?s.getAttribute("ui-namespace")||void 0:i==null?void 0:i.properties.namespace}setVariable(e,t){this.unwatch&&(this.unwatch(),this.unwatch=null),this.variableId=e,this.rendered=!1,console.log("SET VIEW VARIABLE",this,this.variableStore.get(this.variableId)),this.unwatch=this.variableStore.watch(e,(s,i,r)=>{this.render()},t),this.render()}setVariableFromRef(e){console.error("THIS IS ERRONEOUS CODE")}getViewdefKey(){if(this.variableId===null)return;const e=this.variableStore.get(this.variableId);if(!e)return;const t=e.properties.type;if(!t)return;const s=this.getNamespace(),i=this.getFallbackNamespace(),r=this.viewdefStore.get(t,s,i);return r==null?void 0:r.key}render(){if(console.log("1"),this.variableId===null)return!1;const e=this.variableStore.get(this.variableId);if(!e)return this.markPending(),!1;console.log("2");const t=e.properties.type;if(!t)return this.markPending(),!1;const s=this.getNamespace(),i=this.getFallbackNamespace(),r=this.viewdefStore.get(t,s,i);if(!r)return this.markPending(),!1;if(console.log("3"),this.rendered&&t===this.valueType)return!1;console.log("RENDER VIEW",this);const n=this.getElement();if(!n)return console.error("View element not found:",this.elementId),!1;const u=n.childNodes.length>0;let d=null;u?(d=document.createElement("div"),d.className="ui-render-marker",n.appendChild(d)):this.clear();const l=ae(r),o=ce(l);if(n.setAttribute("data-ui-viewdef",r.key),n.appendChild(l),this.processViewLists(n,this.variableId),this.processChildViews(n,this.variableId),this.binding){let h=!d;for(const p of n.children){if(p===d){h=!0;continue}h&&p instanceof HTMLElement&&this.binding.bindElement(p,this.variableId)}}if(d){for(this.clearChildren();n.firstChild!==d;)n.removeChild(n.firstChild);n.removeChild(d)}if(le(o),this.rendered=!0,this.valueType=t,this.binding&&this.binding.setViewForElement(this.elementId,this),this.removePending(),this.binding){const h=this.binding.getWidget(this.elementId);h&&(this._scrollOnOutput&&(h.scrollOnOutput=!0),h.scrollOnOutput&&h.scrollToBottom())}return this.notifyParentRendered(),!0}processViewLists(e,t){const s=e.querySelectorAll("[ui-viewlist]");for(const i of s)i instanceof HTMLElement&&this.setupViewList(i,t)}setupViewList(e,t){const s=pe(e,this.viewdefStore,this.variableStore,this.binding);if(e.getAttribute("ui-viewlist")){const r=s.getBasePath(),n=s.getVariableProperties(),u=B(e),d={path:r,elementId:u,...n},l=this.resolveNamespace(e,t);l&&(d.namespace=l);const o=this.variableStore.get(t);o!=null&&o.properties.fallbackNamespace&&(d.fallbackNamespace=o.properties.fallbackNamespace),d.access||(d.access="r"),this.variableStore.create({parentId:t,properties:d}).then(h=>{s.setVariable(h)}).catch(h=>{console.error("Failed to create viewlist variable:",h)})}this.viewLists.push(s)}processChildViews(e,t){const s=e.querySelectorAll("[ui-view]");for(const i of s)i instanceof HTMLElement&&this.setupChildView(i,t)}setupChildView(e,t){const s=new M(e,this.viewdefStore,this.variableStore,this.binding),i=e.getAttribute("ui-view");if(i){const[r]=i.split("?"),n=N(i);console.log("CREATING VIEW FOR ",i," parent: ",t);let u=n.options.props;u?delete n.options.props:u={},u.scrollOnOutput==="true"&&s.setScrollOnOutput(!0),delete u.scrollOnOutput;const d=B(e),l={path:r,elementId:d,...n.options,...u},o=this.resolveNamespace(e,t);o&&(l.namespace=o);const h=this.variableStore.get(t);h!=null&&h.properties.fallbackNamespace&&(l.fallbackNamespace=h.properties.fallbackNamespace),l.access||(l.access="r"),this.variableStore.create({parentId:t,properties:l}).then(p=>{var f;console.log("GET VIEW VARIABLE ",p," props: ",JSON.stringify((f=this.variableStore.get(p))==null?void 0:f.properties)),s.setVariable(p)}).catch(p=>{console.error("Failed to create view variable:",p)})}this.childViews.push(s)}clearChildren(){for(const e of this.viewLists)e.destroy();this.viewLists=[];for(const e of this.childViews)e.destroy();this.childViews=[]}clear(){this.clearChildren();const e=this.getElement();if(e)for(;e.firstChild;)e.removeChild(e.firstChild);this.rendered=!1}markPending(){this.viewdefStore.addPendingView({id:this.elementId,render:()=>this.render()})}removePending(){this.viewdefStore.removePendingView(this.elementId)}isRendered(){return this.rendered}forceRender(){this.rendered=!1,this.valueType="",this.render()}getVariableId(){return this.variableId}destroy(){this.unwatch&&(this.unwatch(),this.unwatch=null),this.removePending(),this.clear(),this.variableId!==null&&(this.variableStore.destroy(this.variableId),this.variableId=null)}}const ge=1;class me{constructor(e,t,s,i){c(this,"elementId");c(this,"variableId",ge);c(this,"namespace");c(this,"view",null);c(this,"viewdefStore");c(this,"variableStore");c(this,"unwatch",null);c(this,"binding");this.elementId=B(e),this.namespace=e.getAttribute("ui-namespace")||"DEFAULT",this.viewdefStore=t,this.variableStore=s,this.binding=i}getElement(){return document.getElementById(this.elementId)}initialize(){const e=this.getElement();if(!e){console.error("AppView element not found:",this.elementId);return}this.view=new M(e,this.viewdefStore,this.variableStore,this.binding),this.view.setVariable(this.variableId,!0),this.unwatch=this.variableStore.watch(this.variableId,(t,s,i)=>{this.handleRootUpdate(s,i??{})},!1)}handleRootUpdate(e,t){console.log("handleRootUpdate called, props:",Object.keys(t));const s=t.viewdefs;if(s){console.log("Found viewdefs property, length:",s.length);try{const i=JSON.parse(s);typeof i=="object"&&i!==null&&(console.log("Parsed viewdefs, keys:",Object.keys(i)),this.viewdefStore.processViewdefs(i))}catch(i){console.error("Failed to parse viewdefs property:",i)}}else console.log("No viewdefs property found")}getView(){return this.view}isRendered(){var e;return((e=this.view)==null?void 0:e.isRendered())??!1}destroy(){this.unwatch&&(this.unwatch(),this.unwatch=null),this.view&&(this.view.destroy(),this.view=null)}}function F(){return document.querySelector("[ui-app]")}function we(a,e,t){const s=F();if(!s)return null;const i=new me(s,a,e,t);return i.initialize(),i}function ve(a){a=a.replace(/^\//,"");const e=a.indexOf("/");return e===-1?{sessionId:a,path:"/"}:{sessionId:a.substring(0,e),path:"/"+a.substring(e+1)}}function be(){const a=document.cookie.match(/(?:^|; )ui-session=([^;]*)/);return a?a[1]:""}function Ee(){const a=be();if(a)return a;const{sessionId:e}=ve(window.location.pathname);if(!e)throw new Error("No session ID in URL or cookie");return e}class Ie{constructor(){c(this,"connection");c(this,"store");c(this,"viewdefStore");c(this,"binding");c(this,"sessionId");c(this,"appView",null);this.sessionId=this.extractSessionId(),this.connection=new Y(this.sessionId),this.store=new X(this.connection),this.viewdefStore=new de,this.binding=new W(this.store),this.viewdefStore.setViewLookup(e=>this.binding.getView(e))}extractSessionId(){return Ee()}async initialize(){this.connection.onConnect(()=>{console.log("Connected to session:",this.sessionId)}),this.connection.onDisconnect(()=>{console.log("Disconnected from session")}),this.connection.onError(t=>{console.error("Connection error:",t)}),this.connection.onMessage(t=>{this.handleMessage(t)}),await this.connection.connect(),F()&&(this.appView=we(this.viewdefStore,this.store,this.binding))}handleMessage(e){switch(e.type){case"error":const t=e.data;console.error("Server error:",t.description);break}}navigateTo(e){window.history.pushState({},"",e),this.handleNavigation()}handleNavigation(){const s="/"+window.location.pathname.split("/").filter(Boolean).slice(1).join("/");this.store.update(1,void 0,{url:s})}getStore(){return this.store}getViewdefStore(){return this.viewdefStore}getConnection(){return this.connection}getAppView(){return this.appView}}function ye(){const a=new Ie;return a.initialize().then(()=>a)}document.addEventListener("DOMContentLoaded",()=>{F()&&ye().then(e=>{window.uiApp=e,window.uiStore=e.getStore()}).catch(console.error)});
