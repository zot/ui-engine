var T=Object.defineProperty;var O=(c,e,t)=>e in c?T(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var o=(c,e,t)=>O(c,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();function P(c){return JSON.stringify(c)}class M{constructor(e){o(this,"ws",null);o(this,"sessionId");o(this,"reconnectAttempts",0);o(this,"maxReconnectAttempts",5);o(this,"reconnectDelay",1e3);o(this,"messageHandlers",[]);o(this,"errorHandlers",[]);o(this,"connectHandlers",[]);o(this,"disconnectHandlers",[]);o(this,"pendingRequests",new Map);o(this,"requestId",0);o(this,"createCallbackQueue",[]);this.sessionId=e}connect(){return new Promise((e,t)=>{const s=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/${this.sessionId}`;this.ws=new WebSocket(s),this.ws.onopen=()=>{this.reconnectAttempts=0,this.connectHandlers.forEach(r=>r()),e()},this.ws.onmessage=r=>{try{const n=JSON.parse(r.data);"result"in n||"error"in n&&!("type"in n)||"pending"in n||"id"in n?(console.log("RECEIVED RESPONSE",JSON.stringify(n)),this.handleResponse(n)):(console.log("RECEIVED MESSAGE",JSON.stringify(n)),this.handleMessage(n))}catch(n){console.error("Failed to parse message:",n)}},this.ws.onerror=r=>{console.error("WebSocket error:",r),t(new Error("WebSocket connection failed"))},this.ws.onclose=()=>{this.disconnectHandlers.forEach(r=>r()),this.attemptReconnect()}})}attemptReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){this.errorHandlers.forEach(t=>t("Max reconnection attempts reached"));return}this.reconnectAttempts++;const e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);setTimeout(()=>{this.connect().catch(()=>{})},e)}handleMessage(e){this.messageHandlers.forEach(t=>t(e))}handleResponse(e){e.result&&typeof e.result=="object"&&"id"in e.result&&this.createCallbackQueue.length>0&&this.createCallbackQueue.shift()(e)}send(e){this.ws&&this.ws.readyState===WebSocket.OPEN?this.ws.send(P(e)):console.error("WebSocket not connected")}sendAndAwaitResponse(e){return new Promise((t,i)=>{if(!this.ws||this.ws.readyState!==WebSocket.OPEN){i(new Error("WebSocket not connected"));return}this.createCallbackQueue.push(t),this.ws.send(P(e))})}async sendRequest(e){return new Promise(t=>{const i=this.requestId++;this.pendingRequests.set(i,t),this.send(e)})}onMessage(e){return this.messageHandlers.push(e),()=>{const t=this.messageHandlers.indexOf(e);t>=0&&this.messageHandlers.splice(t,1)}}onError(e){return this.errorHandlers.push(e),()=>{const t=this.errorHandlers.indexOf(e);t>=0&&this.errorHandlers.splice(t,1)}}onConnect(e){return this.connectHandlers.push(e),()=>{const t=this.connectHandlers.indexOf(e);t>=0&&this.connectHandlers.splice(t,1)}}onDisconnect(e){return this.disconnectHandlers.push(e),()=>{const t=this.disconnectHandlers.indexOf(e);t>=0&&this.disconnectHandlers.splice(t,1)}}disconnect(){this.ws&&(this.ws.close(),this.ws=null)}isConnected(){return this.ws!==null&&this.ws.readyState===WebSocket.OPEN}}class N{constructor(e){o(this,"variables",new Map);o(this,"errors",new Map);o(this,"watchers",new Map);o(this,"errorWatchers",new Map);o(this,"connection");this.connection=e,e.onMessage(t=>{if(t.type==="update"){const i=t.data;this.handleUpdate(i.varId,i.value,i.properties)}else if(t.type==="destroy"){const i=t.data;this.handleDestroy(i.varId)}else if(t.type==="error"){const i=t.data;i.varId!==void 0&&this.handleError(i.varId,i.code,i.description)}})}handleUpdate(e,t,i,s){let r=this.variables.get(e);r||(r={varId:e,value:void 0,properties:{}},s!==void 0&&(r.parentId=s),this.variables.set(e,r)),console.log("handleUpdate varId",e,"parentId",r.parentId),t!==void 0&&(r.value=t),i&&(r.properties={...r.properties,...i}),this.errors.has(e)&&(this.errors.delete(e),this.notifyErrorWatchers(e,null));const n=this.watchers.get(e);n&&n.forEach(l=>l(r,t,i))}handleError(e,t,i){const s={code:t,description:i};this.errors.set(e,s),this.notifyErrorWatchers(e,s)}notifyErrorWatchers(e,t){const i=this.errorWatchers.get(e);i&&i.forEach(s=>s(t))}handleDestroy(e){this.variables.delete(e),this.watchers.delete(e)}watch(e,t,i){let s=this.watchers.get(e);return s||(s=new Set,this.watchers.set(e,s),i&&this.connection.send({type:"watch",data:{varId:e}})),s.add(t),()=>{s.delete(t),s.size===0&&(this.watchers.delete(e),this.connection.send({type:"unwatch",data:{varId:e}}))}}watchErrors(e,t){let i=this.errorWatchers.get(e);i||(i=new Set,this.errorWatchers.set(e,i)),i.add(t);const s=this.errors.get(e)??null;return t(s),()=>{i.delete(t),i.size===0&&this.errorWatchers.delete(e)}}getError(e){return this.errors.get(e)??null}get(e){return this.variables.get(e)}async create(e){var i;console.log("SENDING CREATE");const t=await this.connection.sendAndAwaitResponse({type:"create",data:e});if(t.error)throw new Error(t.error);if(!t.result)throw new Error("No result from create");if((i=t.pending)!=null&&i.length){const s=t.pending[0].data;console.log("CREATE RESPONSE",t.result.id,t);const r={varId:s.varId,value:void 0,properties:e.properties||{}};e.parentId!==void 0&&(r.parentId=e.parentId),this.variables.set(s.varId,r),setTimeout(()=>{console.log("UPDATE FROM CREATE RESPONSE",s.varId,t),this.handleUpdate(s.varId,s.value,s.properties,e.parentId)})}return t.result.id}update(e,t,i){this.connection.send({type:"update",data:{varId:e,value:t,properties:i}})}destroy(e){this.connection.send({type:"destroy",data:{varId:e}})}sendError(e,t,i){this.connection.send({type:"error",data:{varId:e,code:t,description:i}}),this.handleError(e,t,i)}}function y(c){const[e,t]=c.split("?"),i=e.split("."),s={};if(t){const r=new URLSearchParams(t),n=a=>{const h=r.get(a);return h===""?"true":h};r.has("create")&&(s.create=n("create")),r.has("wrapper")&&(s.wrapper=n("wrapper")),r.has("item")&&(s.item=n("item"));const l={};r.forEach((a,h)=>{h!=="create"&&h!=="wrapper"&&h!=="item"&&(l[h]=a===""?"true":a)}),Object.keys(l).length>0&&(s.props=l)}return{segments:i,options:s}}function S(c){const e={};return c.create&&(e.create=c.create),c.wrapper&&(e.wrapper=c.wrapper),c.item&&(e.item=c.item),c.props&&Object.assign(e,c.props),e}class W{constructor(e){o(this,"store");o(this,"bindings",new Map);this.store=e}bindElement(e,t){const i=[],s=e.getAttribute("ui-value");if(s){const n=this.createValueBinding(e,t,s);n&&i.push(n)}for(const n of Array.from(e.attributes))if(n.name.startsWith("ui-attr-")){const l=n.name.substring(8),a=this.createAttrBinding(e,t,n.value,l);a&&i.push(a)}for(const n of Array.from(e.attributes))if(n.name.startsWith("ui-class-")){const l=n.name.substring(9),a=this.createClassBinding(e,t,n.value,l);a&&i.push(a)}for(const n of Array.from(e.attributes))if(n.name.startsWith("ui-style-")){const l=n.name.substring(9),a=this.createStyleBinding(e,t,n.value,l);a&&i.push(a)}for(const n of Array.from(e.attributes))if(n.name.startsWith("ui-event-")){const l=n.name.substring(9),a=this.createEventBinding(e,t,n.value,l);a&&i.push(a)}const r=e.getAttribute("ui-action");if(r){const n=this.createActionBinding(e,t,r);n&&i.push(n)}i.length>0&&this.bindings.set(e,i);for(const n of Array.from(e.children))this.bindElement(n,t)}unbindElement(e){const t=this.bindings.get(e);t&&(t.forEach(i=>i.unbind()),this.bindings.delete(e));for(const i of Array.from(e.children))this.unbindElement(i)}createValueBinding(e,t,i){var L;const s=y(i),r=S(s.options);r.path=s.segments.join(".");const n=((L=s.options.props)==null?void 0:L.keypress)==="true";let l=null,a=null,h=null;const d=p=>{e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement?e.value=(p==null?void 0:p.toString())??"":e.textContent=(p==null?void 0:p.toString())??""},u=p=>{p?(e.classList.add("ui-error"),e.setAttribute("data-ui-error-code",p.code),e.setAttribute("data-ui-error-description",p.description)):(e.classList.remove("ui-error"),e.removeAttribute("data-ui-error-code"),e.removeAttribute("data-ui-error-description"))},f=p=>{if(l!==null){const g=p.target;this.store.update(l,g.value)}};this.store.create({parentId:t,properties:r}).then(p=>{l=p,a=this.store.watch(p,(X,H)=>d(H)),h=this.store.watchErrors(p,u);const g=this.store.get(p);g&&d(g.value)}).catch(p=>{console.error("Failed to create binding variable:",p)});const w=e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement,v=e.tagName.toLowerCase(),b=v==="sl-input"||v==="sl-textarea";let m=null,E=null;w&&(m=n?"input":"blur"),b&&(E=n?"sl-input":"sl-change"),m&&e.addEventListener(m,f);const V=p=>{if(l!==null){const g=p.target;this.store.update(l,g.value)}};E&&e.addEventListener(E,V);const C=p=>{const g=p;l!==null&&this.store.update(l,g.detail.value)};return e.addEventListener("ui-value-change",C),{element:e,unbind:()=>{a&&a(),h&&h(),m&&e.removeEventListener(m,f),E&&e.removeEventListener(E,V),e.removeEventListener("ui-value-change",C),l!==null&&this.store.destroy(l),e.classList.remove("ui-error"),e.removeAttribute("data-ui-error-code"),e.removeAttribute("data-ui-error-description")}}}createAttrBinding(e,t,i,s){const r=y(i),n=S(r.options);n.path=r.segments.join(".");let l=null,a=null;const h=d=>{d!=null&&d!==!1?e.setAttribute(s,d.toString()):e.removeAttribute(s)};return this.store.create({parentId:t,properties:n}).then(d=>{l=d,a=this.store.watch(d,(f,w)=>h(w));const u=this.store.get(d);u&&h(u.value)}).catch(d=>{console.error("Failed to create attr binding variable:",d)}),{element:e,unbind:()=>{a&&a(),l!==null&&this.store.destroy(l)}}}createClassBinding(e,t,i,s){const r=y(i),n=S(r.options);n.path=r.segments.join(".");let l=null,a=null;const h=d=>{d?e.classList.add(s):e.classList.remove(s)};return this.store.create({parentId:t,properties:n}).then(d=>{l=d,a=this.store.watch(d,(f,w)=>h(w));const u=this.store.get(d);u&&h(u.value)}).catch(d=>{console.error("Failed to create class binding variable:",d)}),{element:e,unbind:()=>{a&&a(),l!==null&&this.store.destroy(l)}}}createStyleBinding(e,t,i,s){const r=y(i),n=S(r.options);n.path=r.segments.join(".");const l=e;let a=null,h=null;const d=u=>{u!=null?l.style.setProperty(s,u.toString()):l.style.removeProperty(s)};return this.store.create({parentId:t,properties:n}).then(u=>{a=u,h=this.store.watch(u,(w,v)=>d(v));const f=this.store.get(u);f&&d(f.value)}).catch(u=>{console.error("Failed to create style binding variable:",u)}),{element:e,unbind:()=>{h&&h(),a!==null&&this.store.destroy(a)}}}createEventBinding(e,t,i,s){const r=i.match(/^([\w.]+)\((.*)\)$/);if(!r)return console.error("Invalid action expression:",i),null;const[,n,l]=r,d={path:l==="_"?`${n}(_)`:`${n}()`,access:"action"};let u=null;this.store.create({parentId:t,properties:d}).then(w=>{u=w}).catch(w=>{console.error("Failed to create action variable:",w)});const f=w=>{u!==null&&this.store.update(u,null)};return e.addEventListener(s,f),{element:e,unbind:()=>{e.removeEventListener(s,f),u!==null&&this.store.destroy(u)}}}createActionBinding(e,t,i){const s=i.match(/^([\w.]+)\((.*)\)$/);if(!s)return console.error("Invalid action expression:",i),null;const[,r,n]=s,h={path:n==="_"?`${r}(_)`:`${r}()`,access:"action"};let d=null;this.store.create({parentId:t,properties:h}).then(f=>{d=f}).catch(f=>{console.error("Failed to create action variable:",f)});const u=f=>{f.preventDefault(),d!==null&&this.store.update(d,null)};return e.addEventListener("click",u),{element:e,unbind:()=>{e.removeEventListener("click",u),d!==null&&this.store.destroy(d)}}}}function k(c){const e=c.indexOf(".");return e===-1?null:{type:c.substring(0,e),namespace:c.substring(e+1)}}function R(c,e){return`${c}.${e}`}function x(c){const e=document.createElement("div");if(e.innerHTML=c.trim(),e.children.length!==1)return null;const t=e.children[0];return t instanceof HTMLTemplateElement?t:null}function B(c,e){const t=k(c);if(!t)return null;const i=x(e);return i?{type:t.type,namespace:t.namespace,template:i}:null}function D(c){return c.template.content.cloneNode(!0)}class F{constructor(){o(this,"viewdefs",new Map);o(this,"pendingViews",new Map);o(this,"errorHandler")}setErrorHandler(e){this.errorHandler=e}store(e,t){const i=B(e,t);return i?(this.viewdefs.set(e,i),!0):(this.errorHandler&&this.errorHandler(e,"Invalid viewdef: must be a single <template> element"),!1)}processViewdefs(e){for(const[t,i]of Object.entries(e))this.store(t,i);this.processPendingViews()}get(e,t){const i=R(e,t),s=this.viewdefs.get(i);if(s)return s;if(t!=="DEFAULT"){const r=R(e,"DEFAULT");return this.viewdefs.get(r)}}getByKey(e){return this.viewdefs.get(e)}has(e,t){return this.get(e,t)!==void 0}addPendingView(e){this.pendingViews.set(e.id,e)}removePendingView(e){this.pendingViews.delete(e)}processPendingViews(){const e=[];for(const[t,i]of this.pendingViews)i.render()&&e.push(t);for(const t of e)this.pendingViews.delete(t)}getPendingViewCount(){return this.pendingViews.size}getViewdefCount(){return this.viewdefs.size}getKeys(){return Array.from(this.viewdefs.keys())}clear(){this.viewdefs.clear()}}function U(c){const[e,t]=c.split("?"),i={path:e,props:{}};return t&&new URLSearchParams(t).forEach((r,n)=>{n==="item"?i.item=r:i.props[n]=r}),i}class _{constructor(e,t,i,s){o(this,"element");o(this,"namespace");o(this,"itemWrapper");o(this,"variableId",null);o(this,"views",[]);o(this,"exemplar");o(this,"viewdefStore");o(this,"variableStore");o(this,"unwatch",null);o(this,"delegate",null);o(this,"bindCallback");o(this,"pathConfig",null);this.element=e,this.namespace=e.getAttribute("ui-namespace")||"list-item",this.itemWrapper=e.getAttribute("ui-item-wrapper")||void 0,this.viewdefStore=t,this.variableStore=i,this.bindCallback=s;const r=e.firstElementChild;r instanceof HTMLElement?(this.exemplar=r.cloneNode(!0),e.removeChild(r)):this.exemplar=document.createElement("div")}getItemWrapper(){}setExemplar(e){this.exemplar=e.cloneNode(!0)}setDelegate(e){this.delegate=e}setPathConfig(e){this.pathConfig=U(e)}getVariableProperties(){const e={};return this.pathConfig&&(this.pathConfig.item&&(e.item=this.pathConfig.item),Object.assign(e,this.pathConfig.props)),e}getBasePath(){var e;return((e=this.pathConfig)==null?void 0:e.path)||""}setVariable(e){this.unwatch&&(this.unwatch(),this.unwatch=null),this.variableId=e,this.unwatch=this.variableStore.watch(e,()=>{this.update()}),this.update()}update(){var n,l;if(this.variableId===null)return;const e=this.variableStore.get(this.variableId);if(!e)return;const t=e.value;if(!Array.isArray(t)){this.clear();return}const i=t.length,s=this.views.slice(),r=[];for(let a=s.length;a<i;a++){const h=this.createItemView();r.push(h),this.element.appendChild(h.element);const d=this.itemWrapper?`${a}?wrapper=${this.itemWrapper}`:String(a),u=this.variableStore.get(this.variableId),f=u!=null&&u.parentId?this.variableStore.get(u.parentId):void 0;console.log("CREATE LIST ITEM VIEW WITH PARENT",JSON.stringify(f));const w={path:d},v=f==null?void 0:f.properties.itemWrapper;v&&(w.wrapper=v),this.variableStore.create({parentId:this.variableId,properties:w}).then(b=>{console.log("setting view ",a," variable ",b),h.setVariable(b)}).catch(b=>{console.error("Failed to create viewlist item variable:",b)}),(n=this.delegate)!=null&&n.onItemAdd&&this.delegate.onItemAdd(h,r.length-1)}for(;s.length>i;){const a=this.views.pop(),h=this.views.length;(l=this.delegate)!=null&&l.onItemRemove&&this.delegate.onItemRemove(a,h),a.destroy(),a.element.parentNode&&a.element.parentNode.removeChild(a.element)}this.views=r}createItemView(){const e=this.exemplar.cloneNode(!0);return new I(e,this.viewdefStore,this.variableStore,this.bindCallback)}clear(){var e;for(let t=this.views.length-1;t>=0;t--){const i=this.views[t];(e=this.delegate)!=null&&e.onItemRemove&&this.delegate.onItemRemove(i,t),i.destroy()}for(this.views=[];this.element.firstChild;)this.element.removeChild(this.element.firstChild)}getCount(){return this.views.length}getView(e){return this.views[e]}getViews(){return[...this.views]}destroy(){this.unwatch&&(this.unwatch(),this.unwatch=null),this.clear()}}function $(c,e,t,i){const s=new _(c,e,t,i),r=c.getAttribute("ui-viewlist");return r&&s.setPathConfig(r),s}let j=1;function q(){return`ui-view-${j++}`}class I{constructor(e,t,i,s){o(this,"element");o(this,"htmlId");o(this,"namespace");o(this,"valueType","");o(this,"variableId",null);o(this,"rendered",!1);o(this,"viewdefStore");o(this,"variableStore");o(this,"unwatch",null);o(this,"bindCallback");o(this,"viewLists",[]);o(this,"childViews",[]);this.element=e,this.htmlId=e.id||q(),e.id||(e.id=this.htmlId),this.namespace=e.getAttribute("ui-namespace")||"DEFAULT",this.viewdefStore=t,this.variableStore=i,this.bindCallback=s,e.getAttribute("ui-view")}setVariable(e,t){this.unwatch&&(this.unwatch(),this.unwatch=null),this.variableId=e,this.rendered=!1,console.log("SET VIEW VARIABLE",this,this.variableStore.get(this.variableId)),this.unwatch=this.variableStore.watch(e,(i,s,r)=>{this.render()},t),this.render()}setVariableFromRef(e){console.error("THIS IS ERRONEOUS CODE")}render(){if(console.log("1"),this.variableId===null)return!1;const e=this.variableStore.get(this.variableId);if(!e)return this.markPending(),!1;console.log("2");const t=e.properties.type;if(!t)return this.markPending(),!1;const i=this.viewdefStore.get(t,this.namespace);if(!i)return this.markPending(),!1;if(console.log("3"),this.rendered&&t===this.valueType)return!1;this.clear(),console.log("RENDER VIEW",this);const s=D(i);if(this.processViewLists(s,this.variableId),this.processChildViews(s,this.variableId),this.bindCallback)for(const r of s.children)r instanceof HTMLElement&&this.bindCallback(r,this.variableId);return this.element.appendChild(s),this.rendered=!0,this.valueType=t,this.removePending(),!0}processViewLists(e,t){const i=e.querySelectorAll("[ui-viewlist]");for(const s of i)s instanceof HTMLElement&&this.setupViewList(s,t)}setupViewList(e,t){const i=$(e,this.viewdefStore,this.variableStore,this.bindCallback);if(e.getAttribute("ui-viewlist")){const r=i.getBasePath(),n=i.getVariableProperties(),l={path:r,...n};this.variableStore.create({parentId:t,properties:l}).then(a=>{i.setVariable(a)}).catch(a=>{console.error("Failed to create viewlist variable:",a)})}this.viewLists.push(i)}processChildViews(e,t){const i=e.querySelectorAll("[ui-view]");for(const s of i)s instanceof HTMLElement&&this.setupChildView(s,t)}setupChildView(e,t){const i=new I(e,this.viewdefStore,this.variableStore,this.bindCallback),s=e.getAttribute("ui-view");if(s){const[r]=s.split("?"),n=y(s);console.log("CREATING VIEW FOR ",s," parent: ",t);let l=n.options.props;l?delete n.options.props:l={},this.variableStore.create({parentId:t,properties:{path:r,...n.options,...l}}).then(a=>{var h;console.log("GET VIEW VARIABLE ",a," props: ",JSON.stringify((h=this.variableStore.get(a))==null?void 0:h.properties)),i.setVariable(a)}).catch(a=>{console.error("Failed to create view variable:",a)})}this.childViews.push(i)}clear(){for(const e of this.viewLists)e.destroy();this.viewLists=[];for(const e of this.childViews)e.destroy();for(this.childViews=[];this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.rendered=!1}markPending(){this.viewdefStore.addPendingView({id:this.htmlId,render:()=>this.render()})}removePending(){this.viewdefStore.removePendingView(this.htmlId)}isRendered(){return this.rendered}getVariableId(){return this.variableId}destroy(){this.unwatch&&(this.unwatch(),this.unwatch=null),this.removePending(),this.clear()}}const z=1;class J{constructor(e,t,i,s){o(this,"element");o(this,"variableId",z);o(this,"namespace");o(this,"view",null);o(this,"viewdefStore");o(this,"variableStore");o(this,"unwatch",null);o(this,"bindCallback");this.element=e,this.namespace=e.getAttribute("ui-namespace")||"DEFAULT",this.viewdefStore=t,this.variableStore=i,this.bindCallback=s}initialize(){this.view=new I(this.element,this.viewdefStore,this.variableStore,this.bindCallback),this.view.setVariable(this.variableId,!0),this.unwatch=this.variableStore.watch(this.variableId,(e,t,i)=>{this.handleRootUpdate(t,i??{})},!1)}handleRootUpdate(e,t){console.log("handleRootUpdate called, props:",Object.keys(t));const i=t.viewdefs;if(i){console.log("Found viewdefs property, length:",i.length);try{const s=JSON.parse(i);typeof s=="object"&&s!==null&&(console.log("Parsed viewdefs, keys:",Object.keys(s)),this.viewdefStore.processViewdefs(s))}catch(s){console.error("Failed to parse viewdefs property:",s)}}else console.log("No viewdefs property found")}getView(){return this.view}isRendered(){var e;return((e=this.view)==null?void 0:e.isRendered())??!1}destroy(){this.unwatch&&(this.unwatch(),this.unwatch=null),this.view&&(this.view.destroy(),this.view=null)}}function A(){return document.querySelector("[ui-app]")}function K(c,e,t){const i=A();if(!i)return null;const s=new J(i,c,e,t);return s.initialize(),s}class G{constructor(){o(this,"connection");o(this,"store");o(this,"viewdefStore");o(this,"binding");o(this,"sessionId");o(this,"appView",null);this.sessionId=this.extractSessionId(),this.connection=new M(this.sessionId),this.store=new N(this.connection),this.viewdefStore=new F,this.binding=new W(this.store)}extractSessionId(){const t=window.location.pathname.split("/").filter(Boolean);if(t.length>0)return t[0];throw new Error("No session ID in URL")}async initialize(){this.connection.onConnect(()=>{console.log("Connected to session:",this.sessionId)}),this.connection.onDisconnect(()=>{console.log("Disconnected from session")}),this.connection.onError(t=>{console.error("Connection error:",t)}),this.connection.onMessage(t=>{this.handleMessage(t)}),await this.connection.connect(),A()&&(this.appView=K(this.viewdefStore,this.store,(t,i)=>this.binding.bindElement(t,i)))}handleMessage(e){switch(e.type){case"error":const t=e.data;console.error("Server error:",t.description);break}}navigateTo(e){window.history.pushState({},"",e),this.handleNavigation()}handleNavigation(){const i="/"+window.location.pathname.split("/").filter(Boolean).slice(1).join("/");this.store.update(1,void 0,{url:i})}getStore(){return this.store}getViewdefStore(){return this.viewdefStore}getConnection(){return this.connection}getAppView(){return this.appView}}function Q(){const c=new G;return c.initialize().then(()=>c)}document.addEventListener("DOMContentLoaded",()=>{A()&&Q().catch(console.error)});
